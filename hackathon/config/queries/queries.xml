<?xml version="1.0" encoding="UTF-8"?>
<queries>
    <query name="FETCH_PENDING_ORDER_HEADER_ENTITY_FOR_REPORT">
        SELECT ih.CmpCode                                                                              AS cmpCode,
               ih.DistrCode                                                                            AS distrCode,
               ih.InvoiceNo                                                                            AS invoiceNo,
               ih.InvoiceDt                                                                            AS invoiceDt,
               ih.SalesmanCode                                                                         AS salesmanCode,
               s.SalesmanName                                                                          AS salesmanName,
               ih.RouteCode                                                                            AS routeCode,
               r.RouteName                                                                             AS routeName,
               ih.CustomerCode                                                                         AS customerCode,
               c.CustomerName                                                                          AS customerName,
               c.MobileNo                                                                              AS mobileNo,
               c.FssaiNo                                                                               AS fssaiNo,
               c.GSTTinNo                                                                              AS gstTinNo,
               CONCAT(csa.CustomerShipAddr1, ', ', csa.CustomerShipAddr2, ', ', csa.CustomerShipAddr3) AS customerShipAddr,
               ih.TotGrossAmt                                                                          AS totGrossAmt,
               ih.TotCashDiscAmt                                                                       AS totCashDiscAmt,
               ih.TotDBDiscAmt                                                                         AS totDBDiscAmt,
               ih.TotSchDiscAmt                                                                        AS totSchDiscAmt,
               ih.TotTaxAmt                                                                            AS totTaxAmt,
               ih.TotNetAmt                                                                            AS totNetAmt,
               ih.RoundOffAmt                                                                          AS roundOffAmt,
               ih.TotCrNoteAmt                                                                         AS totCrNoteAmt,
               ih.Remarks                                                                              AS remarks
        FROM invoiceheader ih
                 INNER JOIN customer C
                            ON ih.CmpCode = c.CmpCode
                                AND ih.DistrCode = c.DistrCode
                                AND ih.CustomerCode = c.CustomerCode
                 INNER JOIN salesman s
                            ON ih.CmpCode = s.CmpCode
                                AND ih.DistrCode = s.DistrCode
                                AND ih.SalesmanCode = s.SalesmanCode
                 INNER JOIN route r
                            ON ih.CmpCode = r.CmpCode
                                AND ih.DistrCode = r.DistrCode
                                AND ih.RouteCode = r.RouteCode
                 INNER JOIN customershipaddress csa
                            ON ih.CmpCode = csa.CmpCode
                                AND ih.DistrCode = csa.DistrCode
                                AND ih.CustomerCode = csa.CustomerCode
                                AND ih.CustomerShipCode = csa.CustomerShipCode
        WHERE ih.CmpCode = ?
          AND ih.DistrCode = ?
          AND ih.InvoiceDt BETWEEN CAST(? AS DATE) AND CAST(? AS DATE)
    </query>

    <query name="FETCH_PENDING_ORDER_DETAIL_ENTITY_FOR_REPORT">
        SELECT ih.CmpCode                                        AS cmpCode,
               ih.DistrCode                                      AS distrCode,
               ih.InvoiceNo                                      AS invoiceNo,
               id.ProdCode                                       AS prodCode,
               p.HSNCode                                         AS hsnCode,
               p.ProdShortName                                   AS prodShortName,
               p.ProdName                                        AS prodName,
               id.ProdBatchCode                                  AS prodBatchCode,
               id.TotalInvoiceQty                                AS totalInvoiceQty,
               id.InvoiceQty1                                    AS invoiceQty1,
               id.UomCode1                                       AS uomCode1,
               id.InputStr                                       AS inputStr,
               id.FreeQty                                        AS freeQty,
               id.MRP                                            AS mrp,
               id.SellRate                                       AS sellRate,
               id.ActualSellRate                                 AS actualSellRate,
               id.CashDiscAmt                                    AS cashDiscAmt,
               id.DBDiscAmt                                      AS dbDiscAmt,
               id.SchDiscAmt                                     AS schDiscAmt,
               id.GrossAmt                                       AS grossAmt,
               id.TaxAmt                                         AS taxAmt,
               id.CGSTPerc                                       AS cgstPerc,
               id.CGSTAmt                                        AS cgstAmt,
               IF(g.UnionTerritoryFlag = 'N', id.SGSTPerc, 0.00) AS sgstPerc,
               IF(g.UnionTerritoryFlag = 'N', id.SGSTAmt, 0.00)  AS sgstAmt,
               IF(g.UnionTerritoryFlag = 'Y', id.SGSTPerc, 0.00) AS utgstPerc,
               IF(g.UnionTerritoryFlag = 'Y', id.SGSTAmt, 0.00)  AS utgstAmt,
               id.IGSTPerc                                       AS igstPerc,
               id.IGSTAmt                                        AS igstAmt,
               id.CessPerc                                       AS cessPerc,
               id.CessAmt                                        AS cessAmt,
               id.NetAmt                                         AS netAmt
        FROM invoiceheader ih
                 INNER JOIN invoicedetails id
                            ON ih.CmpCode = id.CmpCode
                                AND ih.Distrcode = id.Distrcode
                                AND ih.InvoiceNo = id.InvoiceNo
                 INNER JOIN product p
                            ON id.ProdCode = p.ProdCode
                                AND id.CmpCode = p.CmpCode
                 INNER JOIN distributor d
                            ON id.CmpCode = d.CmpCode
                                AND id.DistrCode = d.DistrCode
                 INNER JOIN gststatemaster g
                            ON d.CmpCode = g.CmpCode
                                AND d.GSTStateCode = g.GSTStateCode
        WHERE ih.CmpCode = ?
          AND ih.Distrcode = ?
          AND ih.InvoiceDt BETWEEN CAST(? AS DATE) AND CAST(? AS DATE)
    </query>
    <query name="INSERT_INTO_DELIVERY_ORDER_TABLE" >
        INSERT INTO deliveryordertable (shipping_charges,billing_last_name,billing_phone,giftwrap_charges,total_discount,shipping_state,breadth,
        shipping_city,shipping_phone,billing_customer_name,billing_address,shipping_address_2,shipping_is_billing,billing_state,billing_address_2,billing_email,shipping_address,
        payment_method,height,pickup_location,shipping_customer_name,billing_country,length,weight,order_date,billing_city,shipping_pincode,shipping_email,billing_pincode,sub_total,shipping_last_name,
        comment,order_id,channel_id,shipping_country,transaction_charges,invoice_id)
        values  (:shipping_charges,:billing_last_name,:billing_phone,:giftwrap_charges,:total_discount,:shipping_state,:breadth,
        :shipping_city,:shipping_phone,:billing_customer_name,:billing_address,:shipping_address_2,:shipping_is_billing,:billing_state,:billing_address_2,:billing_email,:shipping_address,
        :payment_method,:height,:pickup_location,:shipping_customer_name,:billing_country,:length,weight,:order_date,:billing_city,:shipping_pincode,:shipping_email,:billing_pincode,:sub_total,:shipping_last_name,
        :comment,:order_id,:channel_id,:shipping_country,:transaction_charges,:invoice_id)
    </query>
    <query name="GET_ORDER_ID_BY_INVOICE_ID_FROM_DELIVERY_ORDER_DETAIL_TABLE" >
        select order_id from delivery_order_details_table where invoice_id = :invoice_id
    </query>
    <query name="GET_ORDER_ID_SHIPMENT_ID_BY_INVOICE_ID_FROM_DELIVERY_ORDER_DETAIL_TABLE" >
        select order_id, shipment_id from delivery_order_details_table where invoice_id = :invoice_id
    </query>
    <query name="FETCH_ORDER_VALUE_FROM_DELIVERY_ORDER_DETAIL_TABLE" >
        select * from delivery_order_details_table where invoice_id = :invoice_id
    </query>
    <query  name="UPDATE_COURIER_CODE_IN_DELIVERY_ORDER_DETAIL_TABLE"  >
        UPDATE delivery_order_details_table
        SET
        courier_code = :courier_code
        WHERE
        invoice_id = :invoice_id
    </query>
    <query  name="UPDATE_STATUS_IN_DELIVERY_ORDER_DETAIL_TABLE"  >
        UPDATE delivery_order_details_table
        SET
        status = :status
        WHERE
        invoice_id = :invoice_id
    </query>
    <query  name="UPDATE_AWB_ORDER_IN_DELIVERY_ORDER_DETAIL_TABLE"  >
        UPDATE delivery_order_details_table
        SET
        awb_code = :awb_code
        WHERE
        invoice_id = :invoice_id
    </query>
    <query name="FETCH_STATUS_FROM_DELIVERY_ORDER_TABLE" >
        select status from delivery_order_details_table where invoice_id = :invoice_id
    </query>
    <query name="INSERT_INTO_DELIVERY_ORDER_DETAIL_TABLE">
        INSERT INTO delivery_order_details_table (order_id,invoice_id,shipment_id,awb_code,courier_code,status)
        values (:order_id,:invoice_id,:shipment_id,:awb_code,:courier_code,:status)
    </query>
</queries>
